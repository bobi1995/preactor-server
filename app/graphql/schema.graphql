## GraphQL Schema (Complete)

scalar DateTime # Assuming you have a DateTime scalar for ISO date strings
type Query {
  hello: String

  # Resource Queries
  """
  Fetches all resources.
  """
  getResources: [Resource!]!
  """
  Fetches a single resource by its ID.
  """
  getResource(id: Int!): Resource
  """
  Fetches all resources that don't belong to any resource group.
  """
  getResourcesWithoutGroup: [Resource!]!

  # ResourceGroup Queries
  """
  Fetches all resource groups.
  """
  getResourceGroups: [ResourceGroup!]!
  """
  Fetches a single resource group by its ID.
  """
  getResourceGroup(id: Int!): ResourceGroup

  # Shift Queries
  getShifts: [Shift]
  getShift(id: ID!): Shift

  # Break Queries
  getBreaks: [Break] # Assuming you want to query all available breaks
  # WeekSchedule Queries
  getSchedules: [Schedule]
  getSchedule(id: ID!): Schedule

  # Orders Queries
  """
  Fetches all orders.
  """
  orders: [Order!]!
  """
  Fetches all orders for a specific resource.
  """
  ordersByResource(resourceId: Int!): [Order!]!
  """
  Fetches all orders for a specific resource group.
  """
  ordersByResourceGroup(resourceGroupId: Int!): [Order!]!

  # Attributes
  getAttributes: [Attribute!]!
  getAttribute(id: Int!): Attribute

  # Changeover Groups
  getChangeoverGroups: [ChangeoverGroup!]!
  getChangeoverGroup(id: Int!): ChangeoverGroup

  # Fetch specific matrix data (optional helpers)
  getChangeoverTimes(changeoverGroupId: Int!): [ChangeoverTime!]!
  getChangeoverDataMatrix(changeoverGroupId: Int!): [ChangeoverData!]!

  # Optimizer Settings and Executions
  getOptimizerSettings: OptimizerSetting!
  getOptimizerExecutions: [OptimizerExecution!]!
  getOptimizationScenarios: [OptimizationScenario!]!
  getOptimizationScenario(id: Int!): OptimizationScenario
}

type Mutation {
  # --- Resource Mutations ---
  """
  Creates a new resource.
  """
  createResource(input: CreateResourceInput!): Resource!
  """
  Updates an existing resource by its ID.
  """
  updateResource(input: UpdateResourceInput!): Resource!
  """
  Deletes a resource by its ID.
  """
  deleteResource(id: Int!): SuccessMessage

  assignScheduleToResource(resourceId: ID!, scheduleId: ID!): Resource # Updates Resource.weekScheduleId
  assignAlternativeShiftToResource(
    input: AssignAlternativeShiftInput!
  ): AlternativeShifts
  # ResourceGroup Mutations
  """
  Creates a new resource group.
  """
  createResourceGroup(input: CreateResourceGroupInput!): ResourceGroup!
  """
  Updates an existing resource group by its ID.
  """
  updateResourceGroup(input: UpdateResourceGroupInput!): ResourceGroup!
  """
  Deletes a resource group by its ID. Also removes all associations in REL_Resource_group.
  """
  deleteResourceGroup(id: Int!): SuccessMessage!
  """
  Adds multiple resources to a resource group.
  """
  addResourcesToGroup(
    resourceIds: [Int!]!
    resourceGroupId: Int!
  ): ResourceGroup!
  """
  Removes a resource from a resource group.
  """
  removeResourceFromGroup(
    resourceId: Int!
    resourceGroupId: Int!
  ): SuccessMessage!
  """
  Removes all resources from a resource group.
  """
  removeAllResourcesFromGroup(resourceGroupId: Int!): SuccessMessage!
  # Shift Mutations
  createShift(input: ShiftFields!): Shift
  updateShift(id: ID!, input: ShiftFields!): Shift # Added update mutation
  deleteShift(id: ID!): SuccessMessage # Or return Shift
  # Break Mutations
  createBreak(input: BreakFields!): Break
  updateBreak(id: ID!, input: BreakFields!): Break # Added update mutation
  deleteBreak(id: ID!): SuccessMessage # Or return Break
  assignBreakToShift(shiftId: ID!, breakId: ID!): Shift # Manages REL_Break_Shift or implicit M2M
  removeBreakFromShift(shiftId: ID!, breakId: ID!): Shift # Manages REL_Break_Shift or implicit M2M
  # WeekSchedule Mutations
  createSchedule(input: CreateWeekScheduleInput!): Schedule
  updateSchedule(id: ID!, input: UpdateWeekScheduleInput!): Schedule
  deleteSchedule(id: ID!): SuccessMessage # Or return WeekSchedule
  updateAlternativeShift(
    id: ID!
    input: UpdateAlternativeShiftInput!
  ): AlternativeShifts # Added update
  deleteAlternativeShift(id: ID!): SuccessMessage # Or return AlternativeShift
  assignMassiveAlternativeShiftToResources(
    input: AssignMassiveAlternativeShiftInput!
  ): [AlternativeShifts]

  # Attribute Management
  createAttribute(input: CreateAttributeInput!): Attribute!
  updateAttribute(id: Int!, input: UpdateAttributeInput!): Attribute!
  deleteAttribute(id: ID!): SuccessMessage!

  # Attribute Parameters
  createAttrParam(input: CreateAttrParamInput!): AttrParam!
  deleteAttrParam(id: Int!): SuccessMessage!

  # Changeover Group Management
  createChangeoverGroup(name: String!): ChangeoverGroup!
  updateChangeoverGroup(id: Int!, name: String!): ChangeoverGroup!
  deleteChangeoverGroup(id: Int!): SuccessMessage!

  # Matrix Logic (Upsert logic required)
  """
  Sets the base time for a Group + Attribute combination. Creates if missing, updates if exists.
  """
  setChangeoverTime(input: SetChangeoverTimeInput!): ChangeoverTime!
  deleteChangeoverTime(id: Int!): SuccessMessage!
  """
  Sets the specific From-To time. Creates if missing, updates if exists.
  """
  setChangeoverData(input: SetChangeoverDataInput!): ChangeoverData!
  deleteChangeoverData(id: Int!): SuccessMessage!

  # --- Order Attributes ---
  """
  Assigns a technical attribute to a Raw Order.
  Validation Logic:
  - If Attribute.isParam is true, you MUST provide attributeParamId.
  - If Attribute.isParam is false, you MUST provide value.
  """
  addOrderAttribute(input: AddOrderAttributeInput!): OrderAttribute!

  """
  Updates an existing attribute assignment (e.g., changing the value or selected parameter).
  """
  updateOrderAttribute(
    id: Int!
    input: UpdateOrderAttributeInput!
  ): OrderAttribute!

  """
  Removes an attribute assignment from an order.
  """
  deleteOrderAttribute(id: Int!): SuccessMessage!

  """
  Updates default settings. Converts priority array to CSV string for DB.
  """
  updateOptimizerSettings(
    input: UpdateOptimizerSettingInput!
  ): OptimizerSetting!

  """
  Runs the python script with specific or default parameters.
  """
  runOptimizer(input: RunOptimizerInput): SuccessMessage!
  createOptimizationScenario(
    input: CreateOptimizationScenarioInput!
  ): OptimizationScenario!
  updateOptimizationScenario(
    input: UpdateOptimizationScenarioInput!
  ): OptimizationScenario!
  deleteOptimizationScenario(id: Int!): SuccessMessage!
  setDefaultScenario(id: Int!): SuccessMessage!
}

type OrderAttribute {
  id: Int!
  orderId: Int!
  # Relation
  attribute: Attribute!
  # If isParam is true, this should be populated
  attributeParam: AttrParam
  # If isParam is false, this should be populated
  value: String
}

type Resource {
  id: Int!
  name: String!
  description: String
  picture: String
  color: String
  """
  External identifier for linking with other systems.
  """
  externalCode: String
  """
  Whether the resource is accumulative (e.g., a buffer).
  """
  accumulative: Boolean

  # --- Relational Fields ---
  """
  The weekly schedule assigned to this resource.
  """
  schedule: Schedule
  """
  Alternative shifts that override the regular schedule.
  """
  alternativeShifts: [AlternativeShifts!]!
  """
  Orders assigned to this resource.
  """
  orders: [Order]!
  """
  The changeover group this resource belongs to.
  """
  changeoverGroup: ChangeoverGroup
}

type ResourceGroup {
  id: Int!
  name: String!
  description: String
  """
  Resources linked to this group via the REL_Resource_group table.
  """
  resourceLinks: [ResourceToGroup!]!
  """
  Orders assigned to this resource group.
  """
  orders: [Order]!
}

type ResourceToGroup {
  resource: Resource!
  resourceGroup: ResourceGroup!
  createdAt: DateTime!
}

type Shift {
  id: ID!
  name: String!
  startHour: String!
  endHour: String!
  breaks: [Break!]!
}

type Break {
  id: ID!
  name: String!
  startTime: String!
  endTime: String!
  shifts: [Shift!]!
}

type Schedule { #
  id: ID!
  name: String
  monday: Shift
  tuesday: Shift
  wednesday: Shift
  thursday: Shift
  friday: Shift
  saturday: Shift
  sunday: Shift
  resources: [Resource]
}

type AlternativeShifts { # Renamed from AlternativeShift to AlternativeShifts
  id: ID!
  shift: Shift! # Assuming a shift is mandatory for an alternative shift record
  resource: Resource!
  startDate: DateTime! # Assuming DateTime scalar
  endDate: DateTime! # Assuming DateTime scalar
  #status: ENUM ("maintenance", "breakdown", "active") # Example status enum
}

type Order {
  id: Int!
  orderNumber: String!
  operationNumber: String!
  startTime: DateTime!
  endTime: DateTime!
  project: String
  duration: Float
  taskIndex: Float
  partNumber: String
  product: String
  opName: String
  remainingQuan: Float
  setupTime: Float

  # Relational fields
  """
  The resource assigned to this order.
  """
  resource: Resource!
  """
  The resource group assigned to this order.
  """
  resourceGroup: ResourceGroup!
  """
  Technical attributes assigned to this order.
  """
  attributes: [OrderAttribute!]!
}

type Attribute {
  id: Int!
  name: String!
  isParam: Boolean
  attributeParameters: [AttrParam!]!
}

type AttrParam {
  id: Int!
  attributeValue: String!
  attributeNote: String
  attributeId: Int!
}

type ChangeoverGroup {
  id: Int!
  name: String!
  changeoverTimes: [ChangeoverTime!]!
}

type ChangeoverTime {
  id: Int!
  changeoverTime: Float
  changeoverGroupId: Int!
  attributeId: Int!
  # Relational resolved fields
  attribute: Attribute
  changeoverGroup: ChangeoverGroup
}

type ChangeoverData {
  id: Int!
  setupTime: Float!
  changeoverGroupId: Int!
  attributeId: Int!
  fromAttrParamId: Int!
  toAttrParamId: Int!
  # Relational resolved fields
  fromAttributeParameter: AttrParam
  toAttributeParameter: AttrParam
}

# --- Optimizer Types ---

type OptimizerSetting {
  id: Int!
  strategy: String!
  campaignWindowDays: Int!
  # âœ… API returns Array, DB stores String
  resourcePriority: [Int!]!
  updatedAt: DateTime!
}

type OptimizerExecution {
  id: Int!
  startTime: DateTime!
  endTime: DateTime
  durationSeconds: Float
  status: String!

  # Snapshot parameters
  strategy: String!
  campaignWindowDays: Int!
  resourcePriority: [Int!] # Snapshot might be empty/null, but we return array
  # Metrics
  recordCount: Int
  errorMessage: String
}

type OptimizationScenario {
  id: Int!
  name: String!
  description: String
  latenessWeight: Int!
  changeoverWeight: Int!
  makespanWeight: Int!
  loadRangeWeight: Int!
  maxLoadWeight: Int!
  gravityWeight: Int!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDefault: Boolean!
}

# --- Utility Types ---
type SuccessMessage {
  success: Boolean!
  message: String
}

type SchedulerResponse {
  success: Boolean!
  message: String
  output: String
}

# --- Input Types ---

"""
Input for creating a new Resource.
"""
input CreateResourceInput {
  name: String!
  description: String
  picture: String
  color: String
  externalCode: String
  accumulative: Boolean
  scheduleId: Int
  changeover_group_id: Int
}

"""
Input for updating an existing Resource.
"""
input UpdateResourceInput {
  id: Int!
  name: String
  description: String
  picture: String
  color: String
  externalCode: String
  accumulative: Boolean
  scheduleId: Int
  changeover_group_id: Int
}

"""
Input for creating a new ResourceGroup.
"""
input CreateResourceGroupInput {
  name: String!
  description: String
}

"""
Input for updating an existing ResourceGroup.
"""
input UpdateResourceGroupInput {
  id: Int!
  name: String
  description: String
}

input ShiftFields { # For create
  name: String
  startHour: String # e.g., "08:00"
  endHour: String # e.g., "17:00"
}

input BreakFields { # For create
  name: String
  startTime: String
  endTime: String
}

input CreateWeekScheduleInput {
  name: String!
  mondayId: ID
  tuesdayId: ID
  wednesdayId: ID
  thursdayId: ID
  fridayId: ID
  saturdayId: ID
  sundayId: ID
}

input UpdateWeekScheduleInput {
  name: String
  mondayId: ID
  tuesdayId: ID
  wednesdayId: ID
  thursdayId: ID
  fridayId: ID
  saturdayId: ID
  sundayId: ID
}

input AssignAlternativeShiftInput {
  resourceId: ID!
  shiftId: ID!
  startDate: DateTime!
  endDate: DateTime!
}

input UpdateAlternativeShiftInput {
  shiftId: ID
  startDate: DateTime
  endDate: DateTime
}

input AssignMassiveAlternativeShiftInput {
  resourceIds: [ID!]!
  shiftId: ID!
  startDate: DateTime!
  endDate: DateTime!
}

input UpdateAttributeInput {
  name: String
  isParam: Boolean
}

input CreateAttrParamNestedInput {
  attributeValue: String!
  attributeNote: String
}

input CreateAttrParamInput {
  attributeId: Int!
  attributeValue: String!
  attributeNote: String
}

input SetChangeoverTimeInput {
  changeoverGroupId: Int!
  attributeId: Int!
  changeoverTime: Float
}

input SetChangeoverDataInput {
  changeoverGroupId: Int!
  attributeId: Int!
  fromAttrParamId: Int!
  toAttrParamId: Int!
  setupTime: Float!
}

input AddOrderAttributeInput {
  orderId: Int!
  attributeId: Int!
  attributeParamId: Int
  value: String
}

input UpdateOrderAttributeInput {
  attributeParamId: Int
  value: String
}

input CreateAttributeInput {
  name: String!
  isParam: Boolean
}

input UpdateOptimizerSettingInput {
  strategy: String
  campaignWindowDays: Int
  resourcePriority: [Int!]
}

input RunOptimizerInput {
  scenarioId: Int!
  campaignWindowDays: Int
  resourcePriority: [Int!]
}

input CreateOptimizationScenarioInput {
  name: String!
  description: String
  latenessWeight: Int
  changeoverWeight: Int
  makespanWeight: Int
  loadRangeWeight: Int
  maxLoadWeight: Int
  gravityWeight: Int
  isDefault: Boolean!
}

input UpdateOptimizationScenarioInput {
  id: Int!
  name: String
  description: String
  latenessWeight: Int
  changeoverWeight: Int
  makespanWeight: Int
  loadRangeWeight: Int
  maxLoadWeight: Int
  gravityWeight: Int
  isDefault: Boolean
}
